"use strict";var e=(e,t,r)=>(s,n)=>{let a=-1;return async function i(h){if(h<=a)throw new Error("next() called multiple times");let o;a=h;let c,d=!1;e[h]?(c=e[h][0][0],s.req.routeIndex=h):c=h===e.length&&n||void 0;if(c)try{o=await c(s,(()=>i(h+1)))}catch(e){if(!(e instanceof Error&&t))throw e;s.error=e,o=await t(e,s),d=!0}else!1===s.finalized&&r&&(o=await r(s));o&&(!1===s.finalized||d)&&(s.res=o);return s}(0)},t=async(e,t=Object.create(null))=>{const{all:n=!1,dot:a=!1}=t,i=(e instanceof b?e.raw.headers:e.headers).get("Content-Type");return i?.startsWith("multipart/form-data")||i?.startsWith("application/x-www-form-urlencoded")?async function(e,t){const n=await e.formData();if(n)return function(e,t){const n=Object.create(null);e.forEach(((e,s)=>{t.all||s.endsWith("[]")?r(n,s,e):n[s]=e})),t.dot&&Object.entries(n).forEach((([e,t])=>{e.includes(".")&&(s(n,e,t),delete n[e])}));return n}(n,t);return{}}(e,{all:n,dot:a}):{}};var r=(e,t,r)=>{void 0!==e[t]?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:e[t]=r},s=(e,t,r)=>{let s=e;const n=t.split(".");n.forEach(((e,t)=>{t===n.length-1?s[e]=r:((!s[e]||"object"!=typeof s[e]||Array.isArray(s[e])||s[e]instanceof File)&&(s[e]=Object.create(null)),s=s[e])}))},n=e=>{const t=e.split("/");return""===t[0]&&t.shift(),t},a=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,((e,r)=>{const s=`@${r}`;return t.push([s,e]),s})),{groups:t,path:e}},i=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},h={},o=(e,t)=>{if("*"===e)return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${e}#${t}`;return h[s]||(r[2]?h[s]=t&&":"!==t[0]&&"*"!==t[0]?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:h[s]=[e,r[1],!0]),h[s]}return null},c=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,(e=>{try{return t(e)}catch{return e}}))}},d=e=>{const t=e.url,r=t.indexOf("/",8);let s=r;for(;s<t.length;s++){const e=t.charCodeAt(s);if(37===e){const e=t.indexOf("?",s),a=t.slice(r,-1===e?void 0:e);return n=a.includes("%25")?a.replace(/%25/g,"%2525"):a,c(n,decodeURI)}if(63===e)break}var n;return t.slice(r,s)},l=e=>{const t=d(e);return t.length>1&&"/"===t.at(-1)?t.slice(0,-1):t},u=(e,t,...r)=>(r.length&&(t=u(t,...r)),`${"/"===e?.[0]?"":"/"}${e}${"/"===t?"":`${"/"===e?.at(-1)?"":"/"}${"/"===t?.[0]?t.slice(1):t}`}`),p=e=>{if(63!==e.charCodeAt(e.length-1)||!e.includes(":"))return null;const t=e.split("/"),r=[];let s="";return t.forEach((e=>{if(""===e||/\:/.test(e)){if(/\:/.test(e))if(/\?/.test(e)){0===r.length&&""===s?r.push("/"):r.push(s);const t=e.replace("?","");s+="/"+t,r.push(s)}else s+="/"+e}else s+="/"+e})),r.filter(((e,t,r)=>r.indexOf(e)===t))},f=e=>/[%+]/.test(e)?(-1!==e.indexOf("+")&&(e=e.replace(/\+/g," ")),-1!==e.indexOf("%")?w(e):e):e,m=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let r=e.indexOf(`?${t}`,8);for(-1===r&&(r=e.indexOf(`&${t}`,8));-1!==r;){const s=e.charCodeAt(r+t.length+1);if(61===s){const s=r+t.length+2,n=e.indexOf("&",s);return f(e.slice(s,-1===n?void 0:n))}if(38==s||isNaN(s))return"";r=e.indexOf(`&${t}`,r+1)}if(s=/[%+]/.test(e),!s)return}const n={};s??=/[%+]/.test(e);let a=e.indexOf("?",8);for(;-1!==a;){const t=e.indexOf("&",a+1);let i=e.indexOf("=",a);i>t&&-1!==t&&(i=-1);let h,o=e.slice(a+1,-1===i?-1===t?void 0:t:i);(s&&(o=f(o)),a=t,""!==o)&&(-1===i?h="":(h=e.slice(i+1,-1===t?void 0:t),s&&(h=f(h))),r?(n[o]&&Array.isArray(n[o])||(n[o]=[]),n[o].push(h)):n[o]??=h)}return t?n[t]:n},g=m,w=decodeURIComponent,y=e=>c(e,w),b=class{raw;#e;#t;routeIndex=0;path;bodyCache={};constructor(e,t="/",r=[[]]){this.raw=e,this.path=t,this.#t=r,this.#e={}}param(e){return e?this.#r(e):this.#s()}#r(e){const t=this.#t[0][this.routeIndex][1][e],r=this.#n(t);return r?/\%/.test(r)?y(r):r:void 0}#s(){const e={},t=Object.keys(this.#t[0][this.routeIndex][1]);for(const r of t){const t=this.#n(this.#t[0][this.routeIndex][1][r]);t&&"string"==typeof t&&(e[r]=/\%/.test(t)?y(t):t)}return e}#n(e){return this.#t[1]?this.#t[1][e]:e}query(e){return g(this.url,e)}queries(e){return((e,t)=>m(e,t,!0))(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach(((e,r)=>{t[r]=e})),t}async parseBody(e){return this.bodyCache.parsedBody??=await t(this,e)}#a=e=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const n=Object.keys(t)[0];return n?t[n].then((t=>("json"===n&&(t=JSON.stringify(t)),new Response(t)[e]()))):t[e]=r[e]()};json(){return this.#a("json")}text(){return this.#a("text")}arrayBuffer(){return this.#a("arrayBuffer")}blob(){return this.#a("blob")}formData(){return this.#a("formData")}addValidatedData(e,t){this.#e[e]=t}valid(e){return this.#e[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return this.#t[0].map((([[,e]])=>e))}get routePath(){return this.#t[0].map((([[,e]])=>e))[this.routeIndex].path}},x=1,R=async(e,t,r,s,n)=>{"object"!=typeof e||e instanceof String||(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const a=e.callbacks;if(!a?.length)return Promise.resolve(e);n?n[0]+=e:n=[e];return Promise.all(a.map((e=>e({phase:t,buffer:n,context:s})))).then((e=>Promise.all(e.filter(Boolean).map((e=>R(e,t,!1,s,n)))).then((()=>n[0]))))},O=(e,t={})=>{for(const r of Object.keys(t))e.set(r,t[r]);return e},v=class{#i;#h;env={};#o;finalized=!1;error;#c=200;#d;#l;#u;#p;#f=!0;#m;#g;#w;#t;#y;constructor(e,t){this.#i=e,t&&(this.#d=t.executionCtx,this.env=t.env,this.#w=t.notFoundHandler,this.#y=t.path,this.#t=t.matchResult)}get req(){return this.#h??=new b(this.#i,this.#y,this.#t),this.#h}get event(){if(this.#d&&"respondWith"in this.#d)return this.#d;throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#d)return this.#d;throw Error("This context has no ExecutionContext")}get res(){return this.#f=!1,this.#p||=new Response("404 Not Found",{status:404})}set res(e){if(this.#f=!1,this.#p&&e)try{for(const[t,r]of this.#p.headers.entries())if("content-type"!==t)if("set-cookie"===t){const t=this.#p.headers.getSetCookie();e.headers.delete("set-cookie");for(const r of t)e.headers.append("set-cookie",r)}else e.headers.set(t,r)}catch(t){if(t instanceof TypeError&&t.message.includes("immutable"))return void(this.res=new Response(e.body,{headers:e.headers,status:e.status}));throw t}this.#p=e,this.finalized=!0}render=(...e)=>(this.#g??=e=>this.html(e),this.#g(...e));setLayout=e=>this.#m=e;getLayout=()=>this.#m;setRenderer=e=>{this.#g=e};header=(e,t,r)=>{if(void 0===t)return this.#l?this.#l.delete(e):this.#u&&delete this.#u[e.toLocaleLowerCase()],void(this.finalized&&this.res.headers.delete(e));r?.append?(this.#l||(this.#f=!1,this.#l=new Headers(this.#u),this.#u={}),this.#l.append(e,t)):this.#l?this.#l.set(e,t):(this.#u??={},this.#u[e.toLowerCase()]=t),this.finalized&&(r?.append?this.res.headers.append(e,t):this.res.headers.set(e,t))};status=e=>{this.#f=!1,this.#c=e};set=(e,t)=>{this.#o??=new Map,this.#o.set(e,t)};get=e=>this.#o?this.#o.get(e):void 0;get var(){return this.#o?Object.fromEntries(this.#o):{}}#b(e,t,r){if(this.#f&&!r&&!t&&200===this.#c)return new Response(e,{headers:this.#u});if(t&&"number"!=typeof t){const r=new Headers(t.headers);this.#l&&this.#l.forEach(((e,t)=>{"set-cookie"===t?r.append(t,e):r.set(t,e)}));const s=O(r,this.#u);return new Response(e,{headers:s,status:t.status??this.#c})}const s="number"==typeof t?t:this.#c;this.#u??={},this.#l??=new Headers,O(this.#l,this.#u),this.#p&&(this.#p.headers.forEach(((e,t)=>{"set-cookie"===t?this.#l?.append(t,e):this.#l?.set(t,e)})),O(this.#l,this.#u)),r??={};for(const[e,t]of Object.entries(r))if("string"==typeof t)this.#l.set(e,t);else{this.#l.delete(e);for(const r of t)this.#l.append(e,r)}return new Response(e,{status:s,headers:this.#l})}newResponse=(...e)=>this.#b(...e);body=(e,t,r)=>"number"==typeof t?this.#b(e,t,r):this.#b(e,t);text=(e,t,r)=>{if(!this.#u){if(this.#f&&!r&&!t)return new Response(e);this.#u={}}return this.#u["content-type"]="text/plain; charset=UTF-8","number"==typeof t?this.#b(e,t,r):this.#b(e,t)};json=(e,t,r)=>{const s=JSON.stringify(e);return this.#u??={},this.#u["content-type"]="application/json","number"==typeof t?this.#b(s,t,r):this.#b(s,t)};html=(e,t,r)=>(this.#u??={},this.#u["content-type"]="text/html; charset=UTF-8","object"==typeof e?R(e,x,!1,{}).then((e=>"number"==typeof t?this.#b(e,t,r):this.#b(e,t))):"number"==typeof t?this.#b(e,t,r):this.#b(e,t));redirect=(e,t)=>(this.#l??=new Headers,this.#l.set("Location",String(e)),this.newResponse(null,t??302));notFound=()=>(this.#w??=()=>new Response,this.#w(this))},E="ALL",j=["get","post","put","delete","options","patch"],H="Can not add a route since the matcher is already built.",$=class extends Error{},k=e=>e.text("404 Not Found",404),F=(e,t)=>"getResponse"in e?e.getResponse():t.text("Internal Server Error",500),C=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#y="/";routes=[];constructor(e={}){[...j,"all"].forEach((e=>{this[e]=(t,...r)=>("string"==typeof t?this.#y=t:this.#x(e,this.#y,t),r.forEach((t=>{this.#x(e,this.#y,t)})),this)})),this.on=(e,t,...r)=>{for(const s of[t].flat()){this.#y=s;for(const t of[e].flat())r.map((e=>{this.#x(t.toUpperCase(),this.#y,e)}))}return this},this.use=(e,...t)=>("string"==typeof e?this.#y=e:(this.#y="*",t.unshift(e)),t.forEach((e=>{this.#x(E,this.#y,e)})),this);const{strict:t,...r}=e;Object.assign(this,r),this.getPath=t??1?e.getPath??d:l}#R(){const e=new C({router:this.router,getPath:this.getPath});return e.routes=this.routes,e}#w=k;errorHandler=F;route(t,r){const s=this.basePath(t);return r.routes.map((t=>{let n;r.errorHandler===F?n=t.handler:(n=async(s,n)=>(await e([],r.errorHandler)(s,(()=>t.handler(s,n)))).res,n.__COMPOSED_HANDLER=t.handler),s.#x(t.method,t.path,n)})),this}basePath(e){const t=this.#R();return t._basePath=u(this._basePath,e),t}onError=e=>(this.errorHandler=e,this);notFound=e=>(this.#w=e,this);mount(e,t,r){let s,n;r&&("function"==typeof r?n=r:(n=r.optionHandler,s=r.replaceRequest));const a=n?e=>{const t=n(e);return Array.isArray(t)?t:[t]}:e=>{let t;try{t=e.executionCtx}catch{}return[e.env,t]};s||=(()=>{const t=u(this._basePath,e),r="/"===t?0:t.length;return e=>{const t=new URL(e.url);return t.pathname=t.pathname.slice(r)||"/",new Request(t,e)}})();return this.#x(E,u(e,"*"),(async(e,r)=>{const n=await t(s(e.req.raw),...a(e));if(n)return n;await r()})),this}#x(e,t,r){e=e.toUpperCase();const s={path:t=u(this._basePath,t),method:e,handler:r};this.router.add(e,t,[r,s]),this.routes.push(s)}#O(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e}#v(t,r,s,n){if("HEAD"===n)return(async()=>new Response(null,await this.#v(t,r,s,"GET")))();const a=this.getPath(t,{env:s}),i=this.router.match(n,a),h=new v(t,{path:a,matchResult:i,env:s,executionCtx:r,notFoundHandler:this.#w});if(1===i[0].length){let e;try{e=i[0][0][0][0](h,(async()=>{h.res=await this.#w(h)}))}catch(e){return this.#O(e,h)}return e instanceof Promise?e.then((e=>e||(h.finalized?h.res:this.#w(h)))).catch((e=>this.#O(e,h))):e??this.#w(h)}const o=e(i[0],this.errorHandler,this.#w);return(async()=>{try{const e=await o(h);if(!e.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return e.res}catch(e){return this.#O(e,h)}})()}fetch=(e,...t)=>this.#v(e,t[1],t[0],e.method);request=(e,t,r,s)=>e instanceof Request?this.fetch(t?new Request(e,t):e,r,s):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${u("/",e)}`,t),r,s));fire=()=>{addEventListener("fetch",(e=>{e.respondWith(this.#v(e.request,e,void 0,e.request.method))}))}},P="[^/]+",S=".*",A="(?:|/.*)",q=Symbol(),D=new Set(".\\+*[^]$()");function I(e,t){return 1===e.length?1===t.length?e<t?-1:1:-1:1===t.length||e===S||e===A?1:t===S||t===A?-1:e===P?1:t===P?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var B=class{#E;#j;#H=Object.create(null);insert(e,t,r,s,n){if(0===e.length){if(void 0!==this.#E)throw q;if(n)return;return void(this.#E=t)}const[a,...i]=e,h="*"===a?0===i.length?["","",S]:["","",P]:"/*"===a?["","",A]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let o;if(h){const e=h[1];let t=h[2]||P;if(e&&h[2]&&(t=t.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(t)))throw q;if(o=this.#H[t],!o){if(Object.keys(this.#H).some((e=>e!==S&&e!==A)))throw q;if(n)return;o=this.#H[t]=new B,""!==e&&(o.#j=s.varIndex++)}n||""===e||r.push([e,o.#j])}else if(o=this.#H[a],!o){if(Object.keys(this.#H).some((e=>e.length>1&&e!==S&&e!==A)))throw q;if(n)return;o=this.#H[a]=new B}o.insert(i,t,r,s,n)}buildRegExpStr(){const e=Object.keys(this.#H).sort(I).map((e=>{const t=this.#H[e];return("number"==typeof t.#j?`(${e})@${t.#j}`:D.has(e)?`\\${e}`:e)+t.buildRegExpStr()}));return"number"==typeof this.#E&&e.unshift(`#${this.#E}`),0===e.length?"":1===e.length?e[0]:"(?:"+e.join("|")+")"}},L=class{#$={varIndex:0};#k=new B;insert(e,t,r){const s=[],n=[];for(let t=0;;){let r=!1;if(e=e.replace(/\{[^}]+\}/g,(e=>{const s=`@\\${t}`;return n[t]=[s,e],t++,r=!0,s})),!r)break}const a=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let e=n.length-1;e>=0;e--){const[t]=n[e];for(let r=a.length-1;r>=0;r--)if(-1!==a[r].indexOf(t)){a[r]=a[r].replace(t,n[e][1]);break}}return this.#k.insert(a,t,s,this.#$,r),s}buildRegExp(){let e=this.#k.buildRegExpStr();if(""===e)return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,((e,n,a)=>void 0!==n?(r[++t]=Number(n),"$()"):void 0!==a?(s[Number(a)]=++t,""):"")),[new RegExp(`^${e}`),r,s]}},N=[],z=[/^$/,[],Object.create(null)],T=Object.create(null);function _(e){return T[e]??=new RegExp("*"===e?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,((e,t)=>t?`\\${t}`:"(?:|/.*)"))}$`)}function M(e,t){if(e)for(const r of Object.keys(e).sort(((e,t)=>t.length-e.length)))if(_(r).test(t))return[...e[r]]}var U=class{name="RegExpRouter";#F;#C;constructor(){this.#F={[E]:Object.create(null)},this.#C={[E]:Object.create(null)}}add(e,t,r){const s=this.#F,n=this.#C;if(!s||!n)throw new Error(H);s[e]||[s,n].forEach((t=>{t[e]=Object.create(null),Object.keys(t[E]).forEach((r=>{t[e][r]=[...t[E][r]]}))})),"/*"===t&&(t="*");const a=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const i=_(t);return e===E?Object.keys(s).forEach((e=>{s[e][t]||=M(s[e],t)||M(s[E],t)||[]})):s[e][t]||=M(s[e],t)||M(s[E],t)||[],Object.keys(s).forEach((t=>{e!==E&&e!==t||Object.keys(s[t]).forEach((e=>{i.test(e)&&s[t][e].push([r,a])}))})),void Object.keys(n).forEach((t=>{e!==E&&e!==t||Object.keys(n[t]).forEach((e=>i.test(e)&&n[t][e].push([r,a])))}))}const i=p(t)||[t];for(let t=0,h=i.length;t<h;t++){const o=i[t];Object.keys(n).forEach((i=>{e!==E&&e!==i||(n[i][o]||=[...M(s[i],o)||M(s[E],o)||[]],n[i][o].push([r,a-h+t+1]))}))}}match(e,t){T=Object.create(null);const r=this.#P();return this.match=(e,t)=>{const s=r[e]||r[E],n=s[2][t];if(n)return n;const a=t.match(s[0]);if(!a)return[[],N];const i=a.indexOf("",1);return[s[1][i],a]},this.match(e,t)}#P(){const e=Object.create(null);return Object.keys(this.#C).concat(Object.keys(this.#F)).forEach((t=>{e[t]||=this.#S(t)})),this.#F=this.#C=void 0,e}#S(e){const t=[];let r=e===E;return[this.#F,this.#C].forEach((s=>{const n=s[e]?Object.keys(s[e]).map((t=>[t,s[e][t]])):[];0!==n.length?(r||=!0,t.push(...n)):e!==E&&t.push(...Object.keys(s[E]).map((e=>[e,s[E][e]])))})),r?function(e){const t=new L,r=[];if(0===e.length)return z;const s=e.map((e=>[!/\*|\/:/.test(e[0]),...e])).sort((([e,t],[r,s])=>e?1:r?-1:t.length-s.length)),n=Object.create(null);for(let e=0,a=-1,i=s.length;e<i;e++){const[i,h,o]=s[e];let c;i?n[h]=[o.map((([e])=>[e,Object.create(null)])),N]:a++;try{c=t.insert(h,a,i)}catch(e){throw e===q?new $(h):e}i||(r[a]=o.map((([e,t])=>{const r=Object.create(null);for(t-=1;t>=0;t--){const[e,s]=c[t];r[e]=s}return[e,r]})))}const[a,i,h]=t.buildRegExp();for(let e=0,t=r.length;e<t;e++)for(let t=0,s=r[e].length;t<s;t++){const s=r[e][t]?.[1];if(!s)continue;const n=Object.keys(s);for(let e=0,t=n.length;e<t;e++)s[n[e]]=h[s[n[e]]]}const o=[];for(const e in i)o[e]=r[i[e]];return[a,o,n]}(t):null}},W=class{name="SmartRouter";#A=[];#C=[];constructor(e){this.#A=e.routers}add(e,t,r){if(!this.#C)throw new Error(H);this.#C.push([e,t,r])}match(e,t){if(!this.#C)throw new Error("Fatal error");const r=this.#A,s=this.#C,n=r.length;let a,i=0;for(;i<n;i++){const n=r[i];try{for(let e=0,t=s.length;e<t;e++)n.add(...s[e]);a=n.match(e,t)}catch(e){if(e instanceof $)continue;throw e}this.match=n.match.bind(n),this.#A=[n],this.#C=void 0;break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(this.#C||1!==this.#A.length)throw new Error("No active router has been determined yet.");return this.#A[0]}},K=Object.create(null),V=class{#q;#H;#D;#I=0;#B=K;constructor(e,t,r){if(this.#H=r||Object.create(null),this.#q=[],e&&t){const r=Object.create(null);r[e]={handler:t,possibleKeys:[],score:0},this.#q=[r]}this.#D=[]}insert(e,t,r){this.#I=++this.#I;let s=this;const h=(e=>{const{groups:t,path:r}=a(e),s=n(r);return i(s,t)})(t),c=[];for(let e=0,t=h.length;e<t;e++){const t=h[e],r=h[e+1],n=o(t,r),a=Array.isArray(n)?n[0]:t;if(Object.keys(s.#H).includes(a)){s=s.#H[a];const e=o(t,r);e&&c.push(e[1])}else s.#H[a]=new V,n&&(s.#D.push(n),c.push(n[1])),s=s.#H[a]}const d=Object.create(null),l={handler:r,possibleKeys:c.filter(((e,t,r)=>r.indexOf(e)===t)),score:this.#I};return d[e]=l,s.#q.push(d),s}#L(e,t,r,s){const n=[];for(let a=0,i=e.#q.length;a<i;a++){const i=e.#q[a],h=i[t]||i[E],o={};if(void 0!==h&&(h.params=Object.create(null),n.push(h),r!==K||s&&s!==K))for(let e=0,t=h.possibleKeys.length;e<t;e++){const t=h.possibleKeys[e],n=o[h.score];h.params[t]=s?.[t]&&!n?s[t]:r[t]??s?.[t],o[h.score]=!0}}return n}search(e,t){const r=[];this.#B=K;let s=[this];const a=n(t),i=[];for(let t=0,n=a.length;t<n;t++){const h=a[t],o=t===n-1,c=[];for(let n=0,d=s.length;n<d;n++){const d=s[n],l=d.#H[h];l&&(l.#B=d.#B,o?(l.#H["*"]&&r.push(...this.#L(l.#H["*"],e,d.#B)),r.push(...this.#L(l,e,d.#B))):c.push(l));for(let s=0,n=d.#D.length;s<n;s++){const n=d.#D[s],l=d.#B===K?{}:{...d.#B};if("*"===n){const t=d.#H["*"];t&&(r.push(...this.#L(t,e,d.#B)),t.#B=l,c.push(t));continue}if(""===h)continue;const[u,p,f]=n,m=d.#H[u],g=a.slice(t).join("/");if(f instanceof RegExp){const t=f.exec(g);if(t){if(l[p]=t[0],r.push(...this.#L(m,e,d.#B,l)),Object.keys(m.#H).length){m.#B=l;const e=t[0].match(/\//)?.length??0;(i[e]||=[]).push(m)}continue}}(!0===f||f.test(h))&&(l[p]=h,o?(r.push(...this.#L(m,e,l,d.#B)),m.#H["*"]&&r.push(...this.#L(m.#H["*"],e,l,d.#B))):(m.#B=l,c.push(m)))}}s=c.concat(i.shift()??[])}return r.length>1&&r.sort(((e,t)=>e.score-t.score)),[r.map((({handler:e,params:t})=>[e,t]))]}},J=class{name="TrieRouter";#N;constructor(){this.#N=new V}add(e,t,r){const s=p(t);if(s)for(let t=0,n=s.length;t<n;t++)this.#N.insert(e,s[t],r);else this.#N.insert(e,t,r)}match(e,t){return this.#N.search(e,t)}};const G=(new class extends C{constructor(e={}){super(e),this.router=e.router??new W({routers:[new U,new J]})}}).basePath("/functions/mcp");G.get("/sse",(async e=>e.text("Hello Hono!"))),G.onError(((e,t)=>t.text("Custom Error Message",500))),G.fire();
